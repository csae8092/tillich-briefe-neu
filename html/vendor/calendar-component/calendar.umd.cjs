(function(d,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(d=typeof globalThis<"u"?globalThis:d||self,o(d.Calendar={}))})(this,function(d){"use strict";var q=Object.defineProperty;var K=(d,o,m)=>o in d?q(d,o,{enumerable:!0,configurable:!0,writable:!0,value:m}):d[o]=m;var h=(d,o,m)=>K(d,typeof o!="symbol"?o+"":o,m);function o(r){return Array.from(new Set(r))}function m(r){return[String(r.getUTCFullYear()),String(r.getUTCMonth()+1).padStart(2,"0"),String(r.getUTCDate()).padStart(2,"0")].join("-")}var U="Assertion failed";function b(r,c){if(r===!1||r==null)throw c==null?new Error(U):typeof c=="function"?c():new Error(c)}function y(r,c){return r>c?[]:Array(c-r+1).fill(null).map((e,n)=>n+r)}const x="acdh-ch-calendar",T="acdh-ch-calendar-year-picker",k="acdh-ch-calendar-year",D="calendar-year-select",I="calendar-event-click";function B(r){const c=[];for(let e=0;e<=11;e++){const n=[],s=new Date(Date.UTC(r,e+1,0)),u=s.getDate();s.setMonth(e);let t=[];for(let a=1;a<=u;a++)s.setDate(a),s.getDay()===1&&(t.length>0&&(t.length<7&&(t=[...Array(7-t.length).fill(null),...t]),n.push(t)),t=[]),t.push(a);t.length>0&&(t.length<7&&(t=[...t,...Array(7-t.length).fill(null)]),n.push(t)),c.push(n)}return c}function S(r){let c=1/0,e=-1/0;for(const n of r){const s=n.date.getTime();s<c&&(c=s),s>e&&(e=s)}return{min:new Date(c),max:new Date(e)}}function H(){return"id-"+crypto.getRandomValues(new Uint32Array(1)).toString()}const w={months:["January","February","March","April","May","June","July","August","September","October","November","December"]};class M extends HTMLElement{constructor(){super();h(this,"data");h(this,"currentYear");h(this,"i18n",w);h(this,"picker");h(this,"calendar");this.data={events:[],eventsByDate:new Map,startYear:null,endYear:null},this.currentYear=null,this.picker=null,this.calendar=null}connectedCallback(){this.picker=this.querySelector(T),this.calendar=this.querySelector(k),b(this.picker,"Missing picker element."),b(this.calendar,"Missing calendar year element."),this.addEventListener(D,e=>{var s;const n=e.detail.year;this.currentYear=n,(s=this.calendar)==null||s.setData({currentYear:this.currentYear,eventsByDate:this.data.eventsByDate.get(this.currentYear)})}),this.update()}setData(e){const n=S(e.events),s=n.min.getUTCFullYear(),u=n.max.getUTCFullYear(),t=new Map;e.events.forEach(a=>{const i=a.date.getUTCFullYear(),l=m(a.date);t.has(i)||t.set(i,new Map);const p=t.get(i);p.has(l)?p.get(l).push(a):p.set(l,[a])}),this.data={events:e.events,eventsByDate:t,startYear:s,endYear:u},e.currentYear!=null&&e.currentYear>=s&&e.currentYear<=u?this.currentYear=e.currentYear:this.currentYear=s,this.update()}update(){const{startYear:e,endYear:n,eventsByDate:s}=this.data,u=this.currentYear;e==null||n==null||u==null||this.picker==null||this.calendar==null||(this.picker.setData({startYear:e,endYear:n,currentYear:u,eventsByDate:s}),this.calendar.setData({currentYear:u,eventsByDate:s.get(u)??null}))}setI18n(e){var n;this.i18n=e,(n=this.calendar)==null||n.setI18n(e)}}class L extends HTMLElement{constructor(){super();h(this,"data");h(this,"variant","full");this.data=null}connectedCallback(){this.update(),this.dataset.variant==="sparse"&&(this.variant="sparse")}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{startYear:e,endYear:n,currentYear:s,eventsByDate:u}=this.data,t=document.createElement("select");y(e,n).forEach(a=>{if(this.variant==="sparse"&&!u.has(a))return;const i=document.createElement("option");i.value=String(a),i.append(document.createTextNode(String(a)));const l=a===s;i.selected=l,t.append(i)}),t.addEventListener("change",a=>{const i=a.currentTarget,l=Number(i.value);this.dispatchEvent(new CustomEvent(D,{detail:{year:l},bubbles:!0}))}),this.innerHTML="",this.append(t)}}class N extends HTMLElement{constructor(){super();h(this,"data");h(this,"variant","full");h(this,"id");this.data=null,this.id=H()}connectedCallback(){this.update(),this.dataset.variant==="sparse"&&(this.variant="sparse")}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{startYear:e,endYear:n,currentYear:s,eventsByDate:u}=this.data,t=document.createElement("div");t.role="radiogroup",y(e,n).forEach(a=>{const i=document.createElement("label"),l=document.createElement("input");l.type="radio",l.name=this.id,l.value=String(a),this.variant==="sparse"&&!u.has(a)&&(l.disabled=!0);const p=a===s;l.checked=p;const g=document.createElement("span");g.append(document.createTextNode(String(a))),i.append(l),i.append(g),t.append(i)}),t.addEventListener("change",a=>{const i=a.target,l=Number(i.value);this.dispatchEvent(new CustomEvent(D,{detail:{year:l},bubbles:!0}))}),this.innerHTML="",this.append(t)}}class A extends HTMLElement{constructor(){super();h(this,"data");h(this,"i18n",w);this.data=null}connectedCallback(){this.update()}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{currentYear:e,eventsByDate:n}=this.data,u=B(e).map((t,a)=>{const i=document.createElement("table"),l=document.createElement("caption");l.textContent=this.i18n.months[a],i.append(l);const p=new Date(Date.UTC(e,a,1));return t.forEach(g=>{const R=document.createElement("tr");g.forEach(v=>{const C=document.createElement("td");if(v!=null){p.setDate(v);const Y=m(p);if(n!=null&&n.has(Y)){const E=n.get(Y),_=o(E.map(j=>j.kind.replace(/\s+/g,"_"))),f=document.createElement("button");f.ariaLabel=Y,f.append(document.createTextNode(String(v))),f.dataset.eventKinds=_.join(" "),f.dataset.eventKindsCount=String(_.length),f.dataset.eventsCount=String(E.length),f.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent(I,{detail:{date:new Date(Y),events:E},bubbles:!0}))}),C.append(f)}else{const E=document.createElement("div");E.append(document.createTextNode(String(v))),C.append(E)}}R.append(C)}),i.append(R)}),i});this.innerHTML="",this.append(...u)}setI18n(e){this.i18n=e}}function F(r){const c=(r==null?void 0:r.picker)==="select"?L:N;customElements.define(x,M),customElements.define(T,c),customElements.define(k,A)}d.Calendar=M,d.CalendarYear=A,d.CalendarYearRadioGroup=N,d.CalendarYearSelect=L,d.getDateRange=S,d.register=F,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
