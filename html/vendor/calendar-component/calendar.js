var B=Object.defineProperty,U=(n,e,a)=>e in n?B(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,d=(n,e,a)=>U(n,typeof e!="symbol"?e+"":e,a);function A(n){return Array.from(new Set(n))}function f(n){return[String(n.getUTCFullYear()),String(n.getUTCMonth()+1).padStart(2,"0"),String(n.getUTCDate()).padStart(2,"0")].join("-")}var H="Assertion failed";function y(n,e){if(n===!1||n==null)throw e==null?new Error(H):typeof e=="function"?e():new Error(e)}function D(n,e){return n>e?[]:Array(e-n+1).fill(null).map((a,i)=>i+n)}const N="acdh-ch-calendar",b="acdh-ch-calendar-year-picker",C="acdh-ch-calendar-year",Y="calendar-year-select",F="calendar-event-click";function I(n){const e=[];for(let a=0;a<=11;a++){const i=[],s=new Date(Date.UTC(n,a+1,0)),l=s.getDate();s.setMonth(a);let t=[];for(let r=1;r<=l;r++)s.setDate(r),s.getDay()===1&&(t.length>0&&(t.length<7&&(t=[...Array(7-t.length).fill(null),...t]),i.push(t)),t=[]),t.push(r);t.length>0&&(t.length<7&&(t=[...t,...Array(7-t.length).fill(null)]),i.push(t)),e.push(i)}return e}function T(n){let e=1/0,a=-1/0;for(const i of n){const s=i.date.getTime();s<e&&(e=s),s>a&&(a=s)}return{min:new Date(e),max:new Date(a)}}function R(){return"id-"+crypto.getRandomValues(new Uint32Array(1)).toString()}const S={months:["January","February","March","April","May","June","July","August","September","October","November","December"]};class k extends HTMLElement{constructor(){super(),d(this,"data"),d(this,"currentYear"),d(this,"i18n",S),d(this,"picker"),d(this,"calendar"),this.data={events:[],eventsByDate:new Map,startYear:null,endYear:null},this.currentYear=null,this.picker=null,this.calendar=null}connectedCallback(){this.picker=this.querySelector(b),this.calendar=this.querySelector(C),y(this.picker,"Missing picker element."),y(this.calendar,"Missing calendar year element."),this.addEventListener(Y,e=>{var a;const i=e.detail.year;this.currentYear=i,(a=this.calendar)==null||a.setData({currentYear:this.currentYear,eventsByDate:this.data.eventsByDate.get(this.currentYear)})}),this.update()}setData(e){const a=T(e.events),i=a.min.getUTCFullYear(),s=a.max.getUTCFullYear(),l=new Map;e.events.forEach(t=>{const r=t.date.getUTCFullYear(),c=f(t.date);l.has(r)||l.set(r,new Map);const u=l.get(r);u.has(c)?u.get(c).push(t):u.set(c,[t])}),this.data={events:e.events,eventsByDate:l,startYear:i,endYear:s},e.currentYear!=null&&e.currentYear>=i&&e.currentYear<=s?this.currentYear=e.currentYear:this.currentYear=i,this.update()}update(){const{startYear:e,endYear:a,eventsByDate:i}=this.data,s=this.currentYear;e==null||a==null||s==null||this.picker==null||this.calendar==null||(this.picker.setData({startYear:e,endYear:a,currentYear:s,eventsByDate:i}),this.calendar.setData({currentYear:s,eventsByDate:i.get(s)??null}))}setI18n(e){var a;this.i18n=e,(a=this.calendar)==null||a.setI18n(e)}}class w extends HTMLElement{constructor(){super(),d(this,"data"),d(this,"variant","full"),this.data=null}connectedCallback(){this.update(),this.dataset.variant==="sparse"&&(this.variant="sparse")}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{startYear:e,endYear:a,currentYear:i,eventsByDate:s}=this.data,l=document.createElement("select");D(e,a).forEach(t=>{if(this.variant==="sparse"&&!s.has(t))return;const r=document.createElement("option");r.value=String(t),r.append(document.createTextNode(String(t)));const c=t===i;r.selected=c,l.append(r)}),l.addEventListener("change",t=>{const r=t.currentTarget,c=Number(r.value);this.dispatchEvent(new CustomEvent(Y,{detail:{year:c},bubbles:!0}))}),this.innerHTML="",this.append(l)}}class M extends HTMLElement{constructor(){super(),d(this,"data"),d(this,"variant","full"),d(this,"id"),this.data=null,this.id=R()}connectedCallback(){this.update(),this.dataset.variant==="sparse"&&(this.variant="sparse")}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{startYear:e,endYear:a,currentYear:i,eventsByDate:s}=this.data,l=document.createElement("div");l.role="radiogroup",D(e,a).forEach(t=>{const r=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name=this.id,c.value=String(t),this.variant==="sparse"&&!s.has(t)&&(c.disabled=!0);const u=t===i;c.checked=u;const p=document.createElement("span");p.append(document.createTextNode(String(t))),r.append(c),r.append(p),l.append(r)}),l.addEventListener("change",t=>{const r=t.target,c=Number(r.value);this.dispatchEvent(new CustomEvent(Y,{detail:{year:c},bubbles:!0}))}),this.innerHTML="",this.append(l)}}class x extends HTMLElement{constructor(){super(),d(this,"data"),d(this,"i18n",S),this.data=null}connectedCallback(){this.update()}setData(e){this.data=e,this.update()}update(){if(this.data==null)return;const{currentYear:e,eventsByDate:a}=this.data,i=I(e).map((s,l)=>{const t=document.createElement("table"),r=document.createElement("caption");r.textContent=this.i18n.months[l],t.append(r);const c=new Date(Date.UTC(e,l,1));return s.forEach(u=>{const p=document.createElement("tr");u.forEach(m=>{const g=document.createElement("td");if(m!=null){c.setDate(m);const v=f(c);if(a!=null&&a.has(v)){const h=a.get(v),E=A(h.map(L=>L.kind.replace(/\s+/g,"_"))),o=document.createElement("button");o.ariaLabel=v,o.append(document.createTextNode(String(m))),o.dataset.eventKinds=E.join(" "),o.dataset.eventKindsCount=String(E.length),o.dataset.eventsCount=String(h.length),o.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent(F,{detail:{date:new Date(v),events:h},bubbles:!0}))}),g.append(o)}else{const h=document.createElement("div");h.append(document.createTextNode(String(m))),g.append(h)}}p.append(g)}),t.append(p)}),t});this.innerHTML="",this.append(...i)}setI18n(e){this.i18n=e}}function j(n){const e=n?.picker==="select"?w:M;customElements.define(N,k),customElements.define(b,e),customElements.define(C,x)}export{k as Calendar,x as CalendarYear,M as CalendarYearRadioGroup,w as CalendarYearSelect,T as getDateRange,j as register};
